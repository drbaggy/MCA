var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var m=a[d];m in c||(c[m]={});c=c[m]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,d){$jscomp.initSymbolIterator();c=null!=c?c:function(a){return a};var b=[],e=a[Symbol.iterator];if("function"==typeof e)for(a=e.call(a);!(e=a.next()).done;)b.push(c.call(d,e.value));else{e=a.length;for(var f=0;f<e;f++)b.push(c.call(d,a[f]))}return b}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var m=b.length;c=c||0;for(0>c&&(c=Math.max(c+m,0));c<m;c++){var e=b[c];if(e===a||Object.is(e,a))return!0}return!1}},"es7","es3");$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");$jscomp.polyfill("Number.parseFloat",function(a){return a||parseFloat},"es6","es3");function qs(a,b){"string"===typeof a&&(b=a,a=document);return a.querySelector(b)}function aqs(a,b){"string"===typeof a&&(b=a);return Array.from(document.querySelectorAll(b))}function _m(a,b,c){"string"===typeof a&&(c=b,b=a);aqs(b).forEach(c)}function _1(a,b,c){"string"===typeof a&&(c=b,b=a);if(a=qs(b))return c(a)}function dis(a){a.classList.remove("active")}function act(a){a.classList.add("active")}function isactive(a){return a.classList.contains("active")}_m("nav:first-of-type ul:first-of-type a, footer p:nth-of-type(2) a, #species a",function(a){a.onclick=function(b){b.preventDefault();_1(a.hash,isactive)||(_m("main > section, nav:first-of-type ul:nth-of-type(n+2)",dis),_1(a.hash,act),_1(a.hash+"-menu",act),find_active_graph())}});_m("ul.datatabs a",function(a){a.onclick=function(b){b.preventDefault();_1(a.hash,isactive)||(b=a.hash.split("-"),_m(b[0]+" > div > section",dis),_1(a.hash,act),find_active_graph())}});_m(".data section h3 a",function(a){a.onclick=function(b){b.preventDefault();_1(a.hash,isactive)||(b=a.hash.split("-"),_m(b[0]+"-"+b[1]+" div",dis),_1(a.hash,act),find_active_graph())}});function find_active_graph(){var a=qs(".active .active .active .graph");Plotly.relayout(a.id,{width:a.offsetWidth,height:a.offsetHeight})}function unpack(a,b){return a.map(function(a){return a[b]})}var xgene=[[68,1,84],[71,45,123],[59,82,139],[44,114,142],[33,144,140],[39,173,129],[93,200,99],[170,220,50],[170,220,50]],stages=[["rings",0,"#78C679"],["early trophozoites",1,"#FEB24C"],["mid trophozoites",2,"#F4CF63"],["late trophozoites",3,"#FEEEAA"],["early schizonts",4,"#85B1D3"],["late schizonts",5,"#C9E8F1"],["early gametocytes",6,"#CAB2D6"],["late gametocytes",7,"#6A3D9A"]],days=[["D1",0,"#D73027"],["D2",1,"#F46D43"],["D3",2,"#FDAE61"],["D4",3,"#FEE090"],["D6",4,"#E0F3F8"],["D8",5,"#ABD9E9"],["D10",6,"#74ADD1"]],configuration={marker_size:5,marker_size_orig:5,marker_size_factor:0},HOVER_TEMPLATE="<b>%{text}</b><br>Stage: %{customdata[0]}<br>Day: %{customdata[1]}<br><br>Co-ord: (%{x},%{y},%{z})<extra></extra>",HOVER_TEMPLATE_GENE="<b>%{text}</b><br>Stage: %{customdata[0]}<br>Day: %{customdata[1]}<br>Expr.: %{customdata[2]}<br><br>Co-ord: (%{x},%{y},%{z})<extra></extra>",colours={stage:{},days:{}};stages.forEach(function(a){return colours.stage[a[0]]=a[2]});days.forEach(function(a){return colours.days[a[0]]=a[2]});load_data("#pf-new");function exp_colour(a,b){if(a==b)return"rgb("+xgene[8][0]+","+xgene[8][1]+","+xgene[8][2]+")";var c=Math.floor(a/b*8);a=a/b-c/8;b=1-a;return"rgb("+(xgene[c][0]*b+xgene[c+1][0]*a)+","+(xgene[c][1]*b+xgene[c+1][1]*a)+","+(xgene[c][2]*b+xgene[c+1][2]*a)+")"}function load_data(a){var b="/mca/data/"+qs(a).dataset.directory+"/samples.json";_m(".loading",function(a){return a.style.display="block"});Plotly.d3.json(b,function(b,d){function c(b){var c=qs(g,"#pf-new-gene").value;if(c in w||""===c)if(_m(qs(".input ul"),"li[style*=block]",function(a){a.style.display="none"}),t===c)"gene"==p&&(Plotly.restyle("pf-new-umap-graph",{"marker.color":[h]}),Plotly.restyle("pf-new-pca-graph",{"marker.color":[h]}));else if(""===c){_m(".pf-extra-title",function(a){a.innerText=""});t=c;h=d.STAGE_HR.map(function(a){return"#ccc"});k=h.map(function(a){return configuration.marker_size_orig});var n=0;b=k.map(function(a){return r[n++]*configuration.marker_size_orig});_m(".gradient span",function(a){return a.innerText="-"});"gene"==p?(Plotly.restyle("pf-new-umap-graph",{"marker.color":[h],"marker.size":[b],customdata:[l],hovertemplate:HOVER_TEMPLATE}),Plotly.restyle("pf-new-pca-graph",{"marker.color":[h],"marker.size":[b],customdata:[l],hovertemplate:HOVER_TEMPLATE})):(Plotly.restyle("pf-new-umap-graph",{"marker.size":[b],customdata:[l],hovertemplate:HOVER_TEMPLATE}),Plotly.restyle("pf-new-pca-graph",{"marker.size":[b],customdata:[l],hovertemplate:HOVER_TEMPLATE}))}else _m(".loading",function(a){a.innerText="LOADING DATA FOR "+c;a.style.display="block"}),Plotly.d3.json("/mca/data/"+qs(a).dataset.directory+"/expression/"+c+".json",function(a,b){t=c;_m(".pf-extra-title",function(a){a.innerText=" - showing expression for gene: "+c});var n=b.max,d=0;0==n?(h=b.data.map(function(a){return"#ccc"}),k=b.data.map(function(a){return configuration.marker_size_orig}),_m(".gradient span",function(a){return a.innerText="-"})):(h=b.data.map(function(a){return exp_colour(a,n)}),k=b.data.map(function(a){return configuration.marker_size+a/n*configuration.marker_size_factor}),_1(".gradient span:first-of-type",function(a){return a.innerText="0.0"}),_1(".gradient span:last-of-type",function(a){return a.innerText=Number.parseFloat(n).toPrecision(2)}));a=k.map(function(a){return r[d++]*a});d=0;q=[l.map(function(a){return[a[0],a[1],b.data[d++]]})];"gene"==p?(Plotly.restyle("pf-new-umap-graph",{"marker.color":[h],"marker.size":[a],customdata:q,hovertemplate:HOVER_TEMPLATE_GENE}),Plotly.restyle("pf-new-pca-graph",{"marker.color":[h],"marker.size":[a],customdata:q,hovertemplate:HOVER_TEMPLATE_GENE})):(Plotly.restyle("pf-new-umap-graph",{"marker.size":[a],customdata:q,hovertemplate:HOVER_TEMPLATE_GENE}),Plotly.restyle("pf-new-pca-graph",{"marker.size":[a],customdata:q,hovertemplate:HOVER_TEMPLATE_GENE}));_m(".loading",function(a){return a.style.display="none"})});else if(x!==c){_m(qs(".input ul"),"li[style*=block]",function(a){a.style.display="none"});x=c;b=0;for(var e=u.length,v=0;v<e;v++){var f=u[v];f.innerText.includes(c)&&(f.style.display="block",b++);if(9<b)break}}}_m(".loading",function(a){return a.innerText="RENDERING CHROMIUM 10x GRAPHS"});var e=d.DAY.map(function(a){return colours.days[a]}),f=d.STAGE_HR.map(function(a){return colours.stage[a]}),y=0,l=d.DAY.map(function(a){return[d.STAGE_HR[y++],a]}),q,h="red",r=d.STAGE_HR.map(function(a){return 1}),t=void 0,x=void 0,p="stage",k=d.STAGE_HR.map(function(a){return configuration.marker_size_orig}),w={},u=aqs(".input ul li");u.forEach(function(a){return w[a.innerText]=1});b=[{x:d.UMAP_1,y:d.UMAP_2,z:d.UMAP_3,mode:"markers",text:d.CELL_ID,marker:{size:[k],color:f,line:{width:0}},customdata:l,hovertemplate:HOVER_TEMPLATE,type:"scatter3d"}];Plotly.newPlot("pf-new-pca-graph",[{x:d.PC_1,y:d.PC_2,z:d.PC_3,mode:"markers",text:d.CELL_ID,marker:{size:[k],color:f,line:{width:0}},customdata:l,hovertemplate:HOVER_TEMPLATE,type:"scatter3d"}],{autosize:!0,margin:{l:5,r:5,b:5,t:5},scene:{xaxis:{range:[-10,25],title:"PC 1"},yaxis:{range:[-12,29],title:"PC 2"},zaxis:{range:[-23,12],title:"PC 3"}}},{responsive:!0,displayModeBar:!0,displaylogo:!1});Plotly.newPlot("pf-new-umap-graph",b,{autosize:!0,margin:{l:5,r:5,b:5,t:5},scene:{xaxis:{range:[-5,6],title:"UMAP 1"},yaxis:{range:[-3,4],title:"UMAP 2"},zaxis:{range:[-6,3],title:"UMAP 3"}}},{responsive:!0,displayModeBar:!0,displaylogo:!1});Plotly.restyle("pf-new-umap-graph",{"marker.size":[k]});Plotly.restyle("pf-new-pca-graph",{"marker.size":[k]});_m(".loading",function(a){return a.innerText="ADDING INTERACTIONS TO GRAPHS"});var g=qs("#pf nav");_m(g,'input[type="radio"]',function(a){a.onchange=function(a){qs(g,'input[type="radio"][value="day"]').checked?(p="day",qs("#legend-day").style.display="block",qs("#legend-gene").style.display="none",qs("#legend-stage").style.display="none",Plotly.restyle("pf-new-umap-graph",{"marker.color":[e]}),Plotly.restyle("pf-new-pca-graph",{"marker.color":[e]})):qs(g,'input[type="radio"][value="stage"]').checked?(qs("#legend-day").style.display="none",qs("#legend-gene").style.display="none",qs("#legend-stage").style.display="block",p="stage",Plotly.restyle("pf-new-umap-graph",{"marker.color":[f]}),Plotly.restyle("pf-new-pca-graph",{"marker.color":[f]})):(qs("#legend-day").style.display="none",qs("#legend-gene").style.display="flex",qs("#legend-stage").style.display="none",p="gene",_m(g,'input[type="text"]',function(a){a.onchange()}))}});_m(g,'input[type="checkbox"]',function(a){a.onchange=function(a){var b={};_m(g,'input[type="checkbox"]',function(a){b[a.value]=a.checked?1:0});var c=0;r=d.STAGE_HR.map(function(a){return b[a]*b[d.DAY[c++]]});c=0;a=k.map(function(a){return r[c++]*a});Plotly.restyle("pf-new-umap-graph",{"marker.size":[a]});Plotly.restyle("pf-new-pca-graph",{"marker.size":[a]})}});_m(g,'input[type="text"]',function(a){a.onkeyup=c;a.onchange=c});_m(g,".input li",function(a){a.onclick=function(a){var b=this;_m(g,'input[type="text"]',function(a){a.value=b.innerText;a.onchange()})}});_m(".svg-container",function(a){a.classList.add("x11");a.style=""});_m(".loading",function(a){return a.style.display="none"})})};
